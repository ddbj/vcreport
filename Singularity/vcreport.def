Bootstrap: docker
From: rubylang/ruby:2.7.0-bionic

%post
    apt -y update
    apt -y upgrade
    apt -y install python python3-pip git build-essential zlib1g zlib1g-dev r-base gdebi-core wget
    apt -y install uuid-dev libgpgme-dev squashfs-tools libseccomp-dev pkg-config cryptsetup-bin
    export VERSION=1.13.5 OS=linux ARCH=amd64 && \
      wget https://dl.google.com/go/go$VERSION.$OS-$ARCH.tar.gz && \
      tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz && \
      rm go$VERSION.$OS-$ARCH.tar.gz
    export GOPATH=${HOME}/go
    export PATH=/usr/local/go/bin:${PATH}:${GOPATH}/bin
    export VERSION=3.6.0 && \
      wget https://github.com/sylabs/singularity/releases/download/v${VERSION}/singularity-${VERSION}.tar.gz && \
      tar -C /tmp -xzf singularity-${VERSION}.tar.gz && \
      cd /tmp/singularity
    ./mconfig && \
      make -C ./builddir && \
      make -C ./builddir install
    pip3 install --upgrade pip
    pip3 install cwlref-runner
    cd /tmp
    git clone https://github.com/tafujino/vcreport.git
    cd vcreport
    git submodule update --init
    gem install bundler
    bundle install
    rake build
    gem install --local pkg/*.gem

%runscript
    vcreport "$@"

%labels
    Author fujino@edu.k.u-tokyo.ac.jp
